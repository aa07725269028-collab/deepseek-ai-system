// ==================== APIs Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© ====================

// API: ØªÙˆÙ„ÙŠØ¯ ÙÙŠØ¯ÙŠÙˆ (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
app.post('/api/generate-video', async (req, res) => {
    try {
        const { text, style, duration } = req.body;
        
        if (!text) {
            return res.json({ success: false, error: 'Ø§Ù„Ù†Øµ Ù…Ø·Ù„ÙˆØ¨' });
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© ØªÙˆÙ„ÙŠØ¯ ÙÙŠØ¯ÙŠÙˆ (ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØªØ³ØªØ®Ø¯Ù… RunwayML)
        const videoId = `video_${Date.now()}`;
        const videoUrl = `https://storage.deepseek.ai/videos/${videoId}.mp4`;
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!database.videos) database.videos = [];
        database.videos.push({
            id: videoId,
            text: text,
            style: style || 'cinematic',
            duration: duration || 10,
            url: videoUrl,
            created_at: new Date().toISOString(),
            views: 0,
            likes: 0
        });

        res.json({
            success: true,
            message: 'ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­',
            data: {
                video_id: videoId,
                video_url: videoUrl,
                text: text,
                style: style,
                duration: duration,
                preview: `https://storage.deepseek.ai/thumbs/${videoId}.jpg`
            }
        });

    } catch (error) {
        res.json({ success: false, error: error.message });
    }
});

// API: Ù†Ø´Ø± ÙÙŠØ¯ÙŠÙˆ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ§Øª
app.post('/api/publish-video', async (req, res) => {
    try {
        const { platforms, title, description } = req.body;
        
        if (!platforms || platforms.length === 0) {
            return res.json({ success: false, error: 'Ø§Ø®ØªØ± Ù…Ù†ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„' });
        }

        const results = [];
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ù†ØµØ©
        for (const platform of platforms) {
            let result;
            
            switch(platform) {
                case 'youtube':
                    result = {
                        platform: 'youtube',
                        success: true,
                        message: 'ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ ÙŠÙˆØªÙŠÙˆØ¨',
                        url: `https://youtube.com/watch?v=yt_${Date.now()}`,
                        video_id: `yt_${Date.now()}`,
                        channel: 'Ù‚Ù†Ø§Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…'
                    };
                    break;
                    
                case 'tiktok':
                    result = {
                        platform: 'tiktok',
                        success: true,
                        message: 'ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ ØªÙŠÙƒ ØªÙˆÙƒ',
                        url: `https://tiktok.com/@user/video/${Date.now()}`,
                        video_id: `tt_${Date.now()}`,
                        hashtags: ['#ÙÙŠØ¯ÙŠÙˆ', '#ØªÙŠÙƒØªÙˆÙƒ']
                    };
                    break;
                    
                case 'instagram':
                    result = {
                        platform: 'instagram',
                        success: true,
                        message: 'ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ Ø¥Ù†Ø³ØªØºØ±Ø§Ù…',
                        url: `https://instagram.com/p/insta_${Date.now()}`,
                        media_id: `ig_${Date.now()}`,
                        likes: 0
                    };
                    break;
                    
                case 'facebook':
                    result = {
                        platform: 'facebook',
                        success: true,
                        message: 'ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ',
                        url: `https://facebook.com/permalink/${Date.now()}`,
                        post_id: `fb_${Date.now()}`,
                        shares: 0
                    };
                    break;
                    
                default:
                    result = {
                        platform: platform,
                        success: false,
                        message: 'Ø§Ù„Ù…Ù†ØµØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©'
                    };
            }
            
            results.push(result);
            
            // ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ Ù…Ù†ØµØ©
            await new Promise(resolve => setTimeout(resolve, 500));
        }

        res.json({
            success: true,
            message: `ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ ${results.filter(r => r.success).length} Ù…Ù†ØµØ©`,
            results: results,
            stats: {
                total_platforms: platforms.length,
                successful: results.filter(r => r.success).length,
                failed: results.filter(r => !r.success).length,
                timestamp: new Date().toISOString()
            }
        });

    } catch (error) {
        res.json({ success: false, error: error.message });
    }
});

// API: Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
app.get('/api/system-stats', (req, res) => {
    const stats = {
        videos_generated: database.videos?.length || 0,
        total_views: database.videos?.reduce((sum, video) => sum + (video.views || 0), 0) || 0,
        total_likes: database.videos?.reduce((sum, video) => sum + (video.likes || 0), 0) || 0,
        platforms_used: ['youtube', 'tiktok', 'instagram', 'facebook'],
        users_count: Object.keys(database.users || {}).length,
        system_status: 'ðŸŸ¢ Ù†Ø´Ø·',
        uptime: process.uptime(),
        memory_usage: process.memoryUsage(),
        api_keys_configured: Object.keys(APIS).filter(key => APIS[key]).length
    };

    res.json({ success: true, stats });
});

// API: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
app.get('/api/videos', (req, res) => {
    const videos = database.videos?.slice(-20).reverse() || [];
    res.json({ success: true, videos, total: videos.length });
});

// ==================== Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ© ====================
// Ø£Ø¶Ù Ù‡Ø°Ø§ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù Ø¨Ø¹Ø¯ ØªØ¹Ø±ÙŠÙ APIS

const database = {
    users: {},
    videos: [],
    platforms: {},
    stats: {
        total_videos: 0,
        total_publishes: 0,
        total_countries: Object.keys(COUNTRIES_CONFIG).length,
        total_platforms: 15
    }
};

// ==================== ØµÙØ­Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====================
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'index.html'));
});

// ==================== ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… ====================
